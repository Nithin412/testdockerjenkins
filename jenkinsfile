pipeline{
    agent any
    environment{
        DOCKER_CREDENTIALS = credentials('dockerhub')
    }
    stages{
        stage("Build docker image"){
            when{
                expression{
                    return params.BUILD_IMAGE;
                }
            }
            steps{
                bat"""
                docker build --no-cache -t testdemo:latest ./fast-api
                docker tag testdemo:latest kandulanithin/nithindatascience:latest
                docker tag testdemo:latest kandulanithin/nithindatascience:d3r2-1
                docker image ls
                """
            }
        }
        stage("Push docker image to docker hub"){
            when{
                expression{
                    return params.PUSH_IMAGE;
                }
            }
            steps{
                bat"""
                echo $DOCKERHUB_CREDENTIALS_PSW | docker login --username $DOCKER_CREDENTIALS_USR --password-stdin 
                docker push kandulanithin/nithindatascience --all-tags
                docker logout
                """  
            }
        }
    }
}
